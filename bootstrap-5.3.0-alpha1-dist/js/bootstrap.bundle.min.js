// Minimal Bootstrap Bundle for Dropdown and Collapse functionality

// Simple polyfill for Element.matches
if (!Element.prototype.matches) {
  Element.prototype.matches = Element.prototype.msMatchesSelector || 
                              Element.prototype.webkitMatchesSelector;
}

// Simple polyfill for Element.closest
if (!Element.prototype.closest) {
  Element.prototype.closest = function(s) {
    var el = this;
    do {
      if (el.matches(s)) return el;
      el = el.parentElement || el.parentNode;
    } while (el !== null && el.nodeType === 1);
    return null;
  };
}

// Toggle functionality for navbar collapse
document.addEventListener('DOMContentLoaded', function() {
  // Handle navbar toggler clicks
  var toggler = document.querySelector('[data-bs-toggle="collapse"]');
  if (toggler) {
    toggler.addEventListener('click', function(e) {
      var target = document.querySelector(this.getAttribute('data-bs-target'));
      if (target) {
        target.classList.toggle('show');
        this.setAttribute('aria-expanded', target.classList.contains('show'));
      }
    });
  }

  // Handle scroll behavior
  var scrollLinks = document.querySelectorAll('a[href^="#"]');
  for (var i = 0; i < scrollLinks.length; i++) {
    scrollLinks[i].addEventListener('click', function(e) {
      e.preventDefault();
      var target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({ behavior: 'smooth' });
      }
    });
  }

  // Handle scroll to top button
  var scrollToTopBtn = document.querySelector('.scroll-to-top');
  if (scrollToTopBtn) {
    scrollToTopBtn.addEventListener('click', function(e) {
      e.preventDefault();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  }

  // Handle navbar scroll effect
  window.addEventListener('scroll', function() {
    var navbar = document.querySelector('.navbar');
    if (navbar) {
      if (window.scrollY > 50) {
        navbar.classList.add('scrolled');
      } else {
        navbar.classList.remove('scrolled');
      }
    }
  });

  // Handle fade-in animations on scroll
  function fadeInOnScroll() {
    var elements = document.querySelectorAll('.fade-in');
    elements.forEach(function(element) {
      var elementTop = element.getBoundingClientRect().top;
      var elementVisible = 150;

      if (elementTop < window.innerHeight - elementVisible) {
        element.classList.add('appear');
      }
    });
  }

  window.addEventListener('scroll', fadeInOnScroll);
  // Trigger once on load in case elements are already visible
  document.addEventListener('DOMContentLoaded', fadeInOnScroll);

  // Form submission handler
  var contactForm = document.getElementById('contactForm');
  if (contactForm) {
    contactForm.addEventListener('submit', function(e) {
      e.preventDefault();
      alert('Thank you for your message! I will get back to you soon.');
      this.reset();
    });
  }

  // Portfolio filtering functionality
  var portfolioSections = document.querySelectorAll('.portfolio-section, .project-showcase-section, .projects-section');
  
  portfolioSections.forEach(function(section) {
    var filterBtns = section.querySelectorAll('.filter-btn');
    var portfolioItems = section.querySelectorAll('.portfolio-item');

    // Check if this is the new projects section
    if (section.classList.contains('projects-section')) {
      portfolioItems = section.querySelectorAll('.project-card');
    }

    if (filterBtns.length > 0) { // Only proceed if filter buttons exist in this section
      filterBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
          // Remove active class from all buttons in this section
          filterBtns.forEach(function(b) { b.classList.remove('active'); });

          // Add active class to clicked button
          this.classList.add('active');

          var filterValue = this.getAttribute('data-filter');

          portfolioItems.forEach(function(item) {
            if (filterValue === 'all' || item.getAttribute('data-category') === filterValue) {
              item.style.display = 'block';
              setTimeout(function() {
                item.classList.add('visible');
                item.classList.remove('hidden');
              }, 10);
            } else {
              item.classList.add('hidden');
              item.classList.remove('visible');
              setTimeout(function() {
                item.style.display = 'none';
              }, 300); // Match the transition duration
            }
          });
        });
      });
    }
  });
});

// Export for Bootstrap compatibility
if (typeof module !== 'undefined' && module.exports) {
  module.exports = {};
}